# Официальный модуль приема платежей Robokassa для Magento 2.4.X
Данный модуль позволяет добавить на сайт способ оплаты через Робокассу. 
Для корректной работы модуля необходима регистрация в сервисе.

Порядок регистрации описан в [документации Robokassa](https://docs.robokassa.ru/#7844)

### Возможности
* Передача состава товаров в заказе для отправки чека клиенту и в налоговую (54-ФЗ);
* Выбор платежной системы при оформление заказа, до отправки на страницу оплаты;
* Выбор нового статуса заказа;
* Порядок сортировки метода на странице оплаты в магазине;
* Автоматическое формирование итогового чека;
* Автоматическая смена статуса заказа;
* Поддержка отправки второго чека;
* Прием платежей в тестовом режиме;
* Выбор системы налогообложения;
* Выбор признака расчета;
* Выбор признака параметра расчета;
* Выбор размера ставки НДС;


### Совместимость
Magento 2.4.X Enterprise и Community.

### Ручная установка

1. Загрузить и разархивировать модуль
2. Переместить модуль в папку app/code/Astrio/
3. php bin/magento module:enable Astrio_Robokassa
4. php bin/magento setup:upgrade
5. php bin/magento setup:di:compile
6. php bin/magento setup:static-content:deploy
7. php bin/magento cache:clean 

Дополнительный материал [How To Install a Magento 2 Extension: Stepwise Guide for Merchants](https://www.nexcess.net/blog/how-to-install-a-magento-2-extension/)


### Настройка модуля

1. Перейти в настройки модуля Stores -> Configuration -> Sales -> Payment Methods -> Robokassa
Выбрать Robokassa и активировать модуль.
2. Зайти в настройки модуля и указать
### обязательные данные:
    * Включено - "Yes".
    * Идентификатор магазина.
    * Пароль 1.
    * Пароль 2.
    * Язык - Определяет на каком языке будет страница Robokassa.
    * Порядок сортировки - определяет порядок вывода метода оплаты на странице оформления заказа (checkout).
### необязательные данные:
    * Заголовок - наименование метода, которое будет отображаться на странице оплаты вашего магазина.
    * Описание - Эта информация отображается в интерфейсе Robokassa и в Электронной квитанции, которая выдается клиенту после успешного платежа. 
    * Новый статус заказа - с каком статусе будет новый созданный ордер. По умолчанию, если оплата через Robokassa прошла штатно, то в magento статус заказа Processing.  
    * Оплата из соответствующих стран - определяет страны, из которых вы принимаете оплату.
    * Оплата из определенных стран - определяет конкретные страны, из которых вы принимаете оплату.

3. Затем сохранить введенные параметры.
4. В личном кабинете Robokassa ("мои магазины" - "настройки" - "технические настройки") указать Result URL, Success URL и Fail URL, которые указаны в настройках модуля, заменив your-domain.ru на домен вшего магазина. 
Например, URL вида http(s)://your-domain.ru/robokassa/checkout/result/, должен быть преобразован в URL вида https://вашсайт.ru/robokassa/checkout/result/ 

### Фискализация

Для подключения автоматического формирования чеков в соответвии с ФЗ-54 необходимо подключить одну из доступных фискальных схем в Личном кабинете Robokassa ([Раздел "Фискализация"](https://partner.robokassa.ru/Fiscalization)) и указать настройки модуля:
* Фискализация - "Yes".
* Система налогообложения.
* Признак способа расчета.
* Признак предмета расчёта.
* Налоговая ставка Robokassa.
* Затем сохранить введенные параметры.


### Уведомления об оплате

Уведомление об оплате Robokassa отправляет автоматически, после успешного совершения платежа, на адрес Result URL, который был скопирован из настроек модуля и указан в технических настройках магазина.
После получения уведомления, заказ в CMS изменит статус на тот, который указан в поле "Новый статус заказа". При правильной настройке Robokassa самостоятельно сообщит в модуль статус оплаты, после чего статус заказа изменится согласно настройке.

### Changelog
= 1.0.1 =
* Изменен "Признак способа расчёта" = "Полный расчет" во втором чеке при выборе:
    * "Признак способа расчёта" (payment_method) = "Предоплпта 100%" (Prepayment 100%)
    * "Признак способа расчёта" (payment_method) = "Предоплпта" (Prepayment)
    * "Признак способа расчёта" (payment_method) = "Аванс" (Advance)